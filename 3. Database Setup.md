### 1. Setting the PostgreSQL Password üîê

You'll set the password directly within PostgreSQL's command-line interface, `psql`. This ensures your database is secure.

---

#### Step 1: Connect to PostgreSQL

First, access the `psql` shell as the superuser, just as outlined in your setup guide.

Bash

```
sudo -i -u postgres
psql
```

---

#### Step 2: Set the User Password

The connection string `postgres://postgres:SECURE...` in your `.env` file indicates the user is named **postgres**.

Run the following SQL command to set the password for the `postgres` user. Replace `'your_secure_password_here'` with the actual password you want to use (e.g., `'SECURE'`).

SQL

```
ALTER USER postgres WITH PASSWORD 'your_secure_password_here';
```

**Note:** The password must be enclosed in single quotes.

---

#### Step 3: Update Your `.env` File

After setting the password in the database, you must ensure the `DATABASE_URL` in your `.env` file uses the **exact same password**.

**Find this line**: `DATABASE_URL="postgres://postgres:SECURE@localhost:5432/attendance_db"`

**And replace `SECURE`** with the password you just created: `DATABASE_URL="postgres://postgres:your_secure_password_here@localhost:5432/attendance_db"`

---

#### Step 4: Exit and Restart

You can now exit the `psql` shell by typing `\q` and pressing Enter. Restart your Node.js application for the new database password to take effect.


## Create Tables for Database

### 1. Connect to your database

First, log in to your `psql` terminal and connect to your database.

Bash

```
sudo -i -u postgres
psql attendance_db
```

---

### 2. Create the `users` table

This table now includes the **HR** role in its `role` constraint.

SQL

```
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    employee_id VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL CHECK (role IN ('EMPLOYEE', 'ADMIN', 'HR')),
    password_hash VARCHAR(255) NOT NULL,
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    email VARCHAR(255) UNIQUE,
    phone VARCHAR(20),
    department VARCHAR(50),
    salary DECIMAL(10, 2),
    date_hired DATE,
    address TEXT
);
```

---

### 3. Create the `attendance` table

This table is unchanged.

SQL

```
CREATE TABLE attendance (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(id),
    check_in_at TIMESTAMPTZ NOT NULL,
    check_out_at TIMESTAMPTZ,
    status VARCHAR(50) NOT NULL CHECK (status IN ('PENDING', 'APPROVED')) DEFAULT 'PENDING',
    approved_by INT REFERENCES users(id),
    approved_at TIMESTAMPTZ
);

CREATE UNIQUE INDEX idx_one_check_in_per_day ON attendance (user_id, CAST(check_in_at AT TIME ZONE 'UTC' AS date));
```

---

### 4. Create the `leaves` table

This table is unchanged.

Based on the backend changes made to handle document uploads, you need to update the `leaves` table schema to include a column for storing the file path.

SQL

```
CREATE TABLE leaves (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(id),
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    reason TEXT,
    status VARCHAR(50) NOT NULL CHECK (status IN ('PENDING', 'APPROVED', 'REJECTED')) DEFAULT 'PENDING',
    applied_at TIMESTAMPTZ DEFAULT NOW(),
    approved_by INT REFERENCES users(id),
    approved_at TIMESTAMPTZ,
    document_path VARCHAR(255)  -- New column to store the path to the uploaded file
);
```


---

### 5. Create the `tasks` table

This table is unchanged.

SQL

```
CREATE TABLE tasks (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(id),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    due_date DATE NOT NULL,
    category VARCHAR(50) NOT NULL,
    priority VARCHAR(50) NOT NULL,
    completed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

After running these commands, type `\q` to exit the `psql` shell.